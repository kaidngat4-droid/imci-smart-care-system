<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ | IMCI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link rel="stylesheet" href="dashboard.css">
<style>
/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† */
.drug-stock-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    border-radius: 10px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 6px 12px rgba(0,0,0,0.05);
}

.drug-stock-table th,
.drug-stock-table td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
}

.drug-stock-table th {
    background: #10b981; /* Ù„ÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    color: #fff;
    font-weight: bold;
}

.drug-stock-table input[type="number"] {
    width: 70px;
    padding: 5px;
    border-radius: 6px;
    border: 1px solid #10b981;
    text-align: center;
}

/* ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ */
.low-stock { background-color: #fef3c7; }   /* Ø£ØµÙØ± */
.out-of-stock { background-color: #fee2e2; } /* Ø£Ø­Ù…Ø± */
.ok-stock { background-color: #d1fae5; }    /* Ø£Ø®Ø¶Ø± */
</style>
</head>
<body>

<header class="topbar">
    <h2>Ø¨Ø±Ù†Ø§Ù…Ø¬ IMCI Ø§Ù„Ø±Ù‚Ù…ÙŠ</h2>
    <div>
        <span id="facilityName"></span>
        <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
</header>

<div class="layout">
    <aside class="sidebar">
        <button onclick="goTo('dashboard.html')"><i class="fa-solid fa-house"></i> ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </aside>

    <div class="dashboard-container">
        <h2>Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ</h2>

        <table class="drug-stock-table">
            <thead>
                <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                    <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
                    <th>Ø§Ù„ÙˆØ§Ø±Ø¯</th>
                    <th>Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
                    <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†</td>
                    <td><input type="number" class="prev" value="0"></td>
                    <td><input type="number" class="in" value="0"></td>
                    <td><input type="number" class="out" value="0"></td>
                    <td class="current">0</td>
                </tr>
                <tr>
                    <td>Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„</td>
                    <td><input type="number" class="prev" value="0"></td>
                    <td><input type="number" class="in" value="0"></td>
                    <td><input type="number" class="out" value="0"></td>
                    <td class="current">0</td>
                </tr>
                <tr>
                    <td>ORS</td>
                    <td><input type="number" class="prev" value="0"></td>
                    <td><input type="number" class="in" value="0"></td>
                    <td><input type="number" class="out" value="0"></td>
                    <td class="current">0</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
if(localStorage.getItem("imci_logged_in") !== "true") {
    window.location.href = "login.html";
}

// Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²
const facility = localStorage.getItem("imci_facility") || "Ù…Ø±ÙƒØ² ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
document.getElementById("facilityName").textContent = facility;

// ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
    localStorage.setItem("imci_logged_in","false");
    window.location.href="login.html";
}
function goTo(page) { window.location.href = page; }

// ===== Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„ÙƒÙ„ Ù…Ø±ÙƒØ² ØµØ­ÙŠ =====
const storageKey = `imci_drug_stock_${facility}`;
let stockData = JSON.parse(localStorage.getItem(storageKey)) || {};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ
const rows = document.querySelectorAll(".drug-stock-table tbody tr");
rows.forEach((row, index) => {
    const prevInput = row.querySelector(".prev");
    const inInput = row.querySelector(".in");
    const outInput = row.querySelector(".out");
    const currentCell = row.querySelector(".current");

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
    if(stockData[index]) {
        prevInput.value = stockData[index].prev;
        inInput.value = stockData[index].incoming;
        outInput.value = stockData[index].outgoing;
    }

    function updateCurrent() {
        const prev = parseInt(prevInput.value) || 0;
        const incoming = parseInt(inInput.value) || 0;
        const outgoing = parseInt(outInput.value) || 0;
        const current = prev + incoming - outgoing;
        currentCell.textContent = current;

        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ÙƒÙ„Ø§Ø³ Ø³Ø§Ø¨Ù‚
        row.classList.remove("low-stock", "out-of-stock", "ok-stock");

        // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙ Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
        if (current <= 0) row.classList.add("out-of-stock");
        else if (current < 5) row.classList.add("low-stock");
        else row.classList.add("ok-stock");

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ LocalStorage
        stockData[index] = { prev, incoming, outgoing };
        localStorage.setItem(storageKey, JSON.stringify(stockData));
    }

    prevInput.addEventListener("input", updateCurrent);
    inInput.addEventListener("input", updateCurrent);
    outInput.addEventListener("input", updateCurrent);

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    updateCurrent();
});
</script>

</body>
</html>